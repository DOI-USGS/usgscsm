version: '0.1.{build}'

image: Visual Studio 2017

platform:
  - x64

configuration:
  - Release

install:
  - git submodule update --init --recursive
  - cmd: call C:\\Miniconda36-x64\Scripts\activate.bat
  - cmd: conda config --set always_yes yes --set changeps1 no
  - cmd: conda update -q conda
  - cmd: conda install conda-build anaconda-client
  - cmd: conda config --set anaconda_upload yes
  - cmd: conda config --add channels usgs-astrogeology
  
before_build:
  - mkdir build
  - cd build
  
build_script:
  - cmake -G "Visual Studio 15 2017 Win64" -DBUILD_TESTS=OFF ..
  - cmake --build . --target ALL_BUILD --config Release

artifacts:
  - path: build\Release\usgscsm.dll
    name: usgscsm.dll

on_success:
- cmd: conda build --token %CONDA_UPLOAD_TOKEN% .

